<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>nugge</title>
  <meta name="description" content="nugge hilft Studenten anzufangen, durchzuhalten und abzuschließen." />
  <style>
    :root{
      --bg:#ffffff;
      --text:#111111;
      --muted:#666666;
      --border:#e9e9e9;
      --soft:#f6f6f6;
      --link:#111111;

      --cta:#111111;
      --ctaText:#ffffff;

      --radius:14px;
      --max:860px;

      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      --serif: ui-serif, Georgia, "Times New Roman", Times, serif;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family:var(--font);
      line-height:1.45;
    }

    .wrap{
      max-width:var(--max);
      margin:0 auto;
      padding:18px 18px 40px 18px;
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:10px 0 18px 0;
      border-bottom:1px solid var(--border);
      gap:12px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width:0;
      cursor:pointer;
      user-select:none;
    }

    .logo{
      width:44px;
      height:44px;
      border-radius:12px;
      overflow:hidden;
      border:1px solid var(--border);
      background:#fff;
      flex:0 0 auto;
    }
    .logo img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }

    .brandText{min-width:0}
    .brandText .name{
      font-family:var(--serif);
      font-size:20px;
      margin:0;
      letter-spacing:.1px;
      text-transform:none;
    }

    .statusRow{
      display:flex;
      align-items:center;
      gap:10px;
      flex:0 0 auto;
    }

    .pill{
      font-size:12px;
      color:var(--muted);
      border:1px solid var(--border);
      padding:7px 10px;
      border-radius:999px;
      background:#fff;
      user-select:none;
    }

    a{
      color:var(--link);
      text-decoration:underline;
      text-underline-offset:2px;
    }

    button{
      appearance:none;
      border:1px solid var(--border);
      background:#fff;
      color:var(--text);
      padding:11px 14px;
      border-radius:12px;
      font-weight:650;
      cursor:pointer;
      transition: transform .06s ease, background .15s ease, border-color .15s ease;
    }
    button:hover{background:var(--soft); border-color:#dddddd}
    button:active{transform:translateY(1px)}

    .primary{
      background:var(--cta);
      color:var(--ctaText);
      border-color:var(--cta);
    }
    .primary:hover{filter:brightness(0.98)}

    main{padding-top:18px}
    .view{display:none}
    .view.active{display:block}

    /* Hero */
    .hero{padding:18px 0 10px 0}
    .heroCenterIcon{
      display:flex;
      justify-content:center;
      margin:10px 0 14px 0;
    }
    .heroCenterIcon img{
      width:140px;
      height:140px;
      border-radius:32px;
      border:1px solid var(--border);
      object-fit:cover;
      background:#fff;
    }

    .hero h1{
      font-family:var(--serif);
      font-size:44px;
      line-height:1.05;
      margin:0 0 10px 0;
      letter-spacing:-.2px;
      text-align:center;
      text-transform:lowercase;
    }
    .hero h2{
      margin:0 auto 14px auto;
      color:var(--muted);
      font-size:16px;
      max-width:70ch;
      text-align:center;
      font-weight:550;
    }
    .hero p{
      margin:0 auto 14px auto;
      color:var(--muted);
      font-size:15px;
      max-width:74ch;
      text-align:center;
    }

    .ctaRow{
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      justify-content:center;
      gap:14px;
      margin-top:10px;
    }

    /* Divider */
    .rule{
      margin:20px auto 10px auto;
      max-width:540px;
      color:var(--muted);
      text-align:center;
      font-size:14px;
      letter-spacing:.2px;
    }

    /* Sections */
    .sectionTitle{
      margin:26px 0 10px 0;
      font-family:var(--serif);
      font-size:18px;
    }

    .list{
      display:grid;
      gap:12px;
      margin-top:8px;
    }

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width:720px){
      .grid2{grid-template-columns:1fr}
    }

    .card{
      border:1px solid var(--border);
      border-radius:var(--radius);
      background:#fff;
      padding:14px;
    }

    .topRow{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:10px;
    }
    .user{
      font-weight:650;
      font-size:14px;
      letter-spacing:.1px;
      color:#111;
    }
    .subscribe{
      font-size:13px;
      color:var(--text);
    }
    .msg{
      margin:10px 0 10px 0;
      color:#222;
      font-size:14px;
      max-width:75ch;
    }
    .metaLine{
      font-size:12px;
      color:var(--muted);
      margin-top:6px;
    }

    /* Pick page */
    .pickGrid{
      display:grid;
      gap:12px;
      margin-top:8px;
    }
    .pickBlock{
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:14px;
      background:#fff;
    }
    .pickBlock h2{
      margin:0 0 10px 0;
      font-size:14px;
      letter-spacing:.2px;
      font-weight:850;
    }
    .choices{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
    }
    .choice{
      padding:10px 12px;
      border-radius:999px;
      border:1px solid var(--border);
      background:#fff;
      cursor:pointer;
      user-select:none;
      font-weight:650;
      font-size:13px;
      transition: background .15s ease, border-color .15s ease, transform .06s ease;
    }
    .choice:hover{background:var(--soft); border-color:#dddddd}
    .choice:active{transform:translateY(1px)}
    .choice.selected{
      border-color:#111;
      background:#111;
      color:#fff;
    }

    .actions{
      display:flex;
      flex-wrap:wrap;
      gap:12px;
      align-items:center;
      margin-top:14px;
    }

    /* Today view */
    .todayHeader{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:10px;
      margin:0 0 10px 0;
    }
    .todayHeader h2{
      margin:0;
      font-family:var(--serif);
      font-size:18px;
    }
    .todayHeader .date{
      font-size:12px;
      color:var(--muted);
    }

    /* Learn more page */
    .learnFull{
      min-height:70vh;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding:28px 10px;
    }
    .learnFull .box{
      max-width:72ch;
      color:#111;
      font-size:16px;
      line-height:1.6;
      font-family:var(--font);
      white-space:pre-wrap;
    }

    /* Nugge detail page */
    .detailHeader{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:10px;
      margin:0 0 10px 0;
    }
    .detailHeader h2{
      margin:0;
      font-family:var(--serif);
      font-size:18px;
    }
    .detailHeader .sub{
      font-size:12px;
      color:var(--muted);
    }

    /* Testimonials */
    .quote{
      font-size:14px;
      color:#222;
      margin:0;
    }
    .who{
      margin-top:8px;
      font-size:12px;
      color:var(--muted);
    }

    footer{
      margin-top:36px;
      padding-top:18px;
      border-top:1px solid var(--border);
      color:var(--muted);
      font-size:12px;
      display:flex;
      justify-content:center;
      text-align:center;
    }

    @media (max-width:560px){
      .hero h1{font-size:36px}
      header{align-items:flex-start}
      .heroCenterIcon img{width:120px;height:120px;border-radius:28px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand" id="brandHome" title="Home">
        <div class="logo" aria-hidden="true">
          <img alt="nugge icon" src="icon.png" />
        </div>
        <div class="brandText">
          <p class="name">nugge</p>
        </div>
      </div>

      <div class="statusRow">
        <span class="pill" id="statusPill">Sign in</span>
        <button id="logoutBtn" type="button" style="display:none">Log out</button>
      </div>
    </header>

    <main>
      <!-- HOME -->
      <section class="view active" id="viewHome">
        <div class="hero">
          <div class="heroCenterIcon" aria-hidden="true">
            <img alt="nugge icon large" src="icon.png" />
          </div>

          <h1>nugge</h1>
          <h2>Nugge hilft Studenten anzufangen, durchzuhalten und abzuschließen</h2>
          <p>
            Mini-Impulse, die in unter 2 Minuten starten. Für Lernen, Aufgaben, Schreiben und Code.<br/>
            Du wählst kurz, wo du hängst. Nugge liefert dir den nächsten machbaren Schritt.
          </p>

          <div class="ctaRow">
            <button class="primary" id="getNuggedBtn" type="button">Starte deinen kostenlosen 7-Tage-Sprint</button>
            <a href="#" id="learnMoreLink">Learn more</a>
          </div>

          <div class="rule">⸻</div>
        </div>

        <div class="sectionTitle">Beispiele: Student (m) · Informatik/Mathe · Thesis/Übungen starten</div>
        <div class="list" id="featuredStudentM"></div>

        <div class="sectionTitle">Beispiele: Studentin (w) · Geistes-/Sozialwissenschaften · Lesen/Schreiben starten</div>
        <div class="list" id="featuredStudentW"></div>

        <div class="rule">⸻</div>

        <div class="sectionTitle">Stimmen von Studierenden</div>
        <div class="grid2" id="testimonials"></div>
      </section>

      <!-- LEARN MORE FULL PAGE -->
      <section class="view" id="viewLearn">
        <div class="learnFull">
          <div class="box" id="learnText"></div>
        </div>
      </section>

      <!-- PICK -->
      <section class="view" id="viewPick">
        <div class="sectionTitle">Wähle kurz, wo du hängst</div>

        <div class="pickGrid">
          <div class="pickBlock">
            <h2>Modus</h2>
            <div class="choices" id="modeChoices"></div>
          </div>

          <div class="pickBlock">
            <h2>Fokus</h2>
            <div class="choices" id="focusChoices"></div>
          </div>

          <div class="actions">
            <button class="primary" id="continueBtn" type="button" disabled>Weiter</button>
            <a href="#" id="backHomeLink">Back</a>
          </div>
        </div>
      </section>

      <!-- TODAY -->
      <section class="view" id="viewToday">
        <div class="todayHeader">
          <h2>Dein nugge für heute</h2>
          <div class="date" id="todayDate"></div>
        </div>

        <div class="card">
          <div class="topRow">
            <div class="user" id="todayUser"></div>
            <a class="subscribe" href="#" id="todaySubscribeLink">Subscribe</a>
          </div>
          <div class="msg" id="todayMsg"></div>
          <div class="metaLine" id="todayStamp"></div>

          <div class="actions" style="margin-top:14px">
            <button class="primary" id="newNuggBtn" type="button">Neuer nugge</button>
            <button id="changePickBtn" type="button">Ändern</button>
          </div>
        </div>
      </section>

      <!-- NUGGE DETAIL (from Subscribe) -->
      <section class="view" id="viewDetail">
        <div class="detailHeader">
          <h2>nugge Detail</h2>
          <div class="sub" id="detailSub"></div>
        </div>

        <div class="card">
          <div class="topRow">
            <div class="user" id="detailUser"></div>
            <a class="subscribe" href="#" id="detailBackLink">Back</a>
          </div>
          <div class="msg" id="detailMsg"></div>
          <div class="metaLine" id="detailStamp"></div>
          <div class="metaLine" id="detailStats"></div>

          <div class="actions" style="margin-top:14px">
            <button class="primary" id="detailSubscribeBtn" type="button">Subscribe</button>
            <button id="detailGetNuggedBtn" type="button">Starte Sprint</button>
          </div>
        </div>
      </section>
    </main>

    <footer>
      <div>nugge trade mark and patents pending</div>
    </footer>
  </div>

  <script>
    // ---------------- Featured content ----------------
    const FEATURED_M = [
      { key:"m|Mo 08:10", time:"Mo 08:10", text:"Jetzt 90 Sekunden: Öffne IDE/Notebook und schreibe nur den Funktionsnamen + 1 Kommentar: ‘TODO: input/output’." },
      { key:"m|Di 12:45", time:"Di 12:45", text:"2-Minuten-Mathe-Start: Schreib die Aufgabe ab und markiere genau 1 Unbekannte. Ergebnis: 1 Satz ‘Gesucht ist …’." },
      { key:"m|Mi 19:20", time:"Mi 19:20", text:"Rohstart statt Perfekt: Erstelle eine Datei ‘notes.md’ und schreibe 3 Bulletpoints, was du heute verstanden hast (auch wenn’s dünn ist)." },
      { key:"m|Do 15:05", time:"Do 15:05", text:"Wenn du gerade entsperrst: Leg das Handy 2 Meter weg und starte einen 2-Minuten-Timer. In der Zeit: nur ‘Run’ drücken oder Test ausführen." },
      { key:"m|Fr 09:30", time:"Fr 09:30", text:"Mini-Plan: Schreib 1 ‘Next Step’-Zeile: ‘Als nächstes implementiere ich ____’. Dann sofort 1 Zeile Code tippen." },
      { key:"m|Sa 11:15", time:"Sa 11:15", text:"Debug-Shortcut: Öffne das letzte Error-Log und kopiere eine Fehlermeldung in deine Notizen. Ergebnis: 1 klarer Gegner." },
      { key:"m|So 18:40", time:"So 18:40", text:"Wochenschluss ohne Drama: Öffne dein Projekt und schreibe 1 Satz: ‘Nächsten Montag beginne ich mit ____’. Speichern. Fertig." }
    ];

    const FEATURED_W = [
      { key:"w|Mo 09:05", time:"Mo 09:05", text:"2-Minuten-Schreibstart: Öffne dein Dokument und schreibe nur die Überschrift + darunter 1 Satz: ‘In diesem Abschnitt geht es um …’." },
      { key:"w|Di 13:10", time:"Di 13:10", text:"Lesen ohne Überforderung: Stell einen 2-Minuten-Timer und lies nur den Abstract/Einleitungssatz. Ergebnis: 1 Satz ‘Kernaussage: …’." },
      { key:"w|Mi 17:25", time:"Mi 17:25", text:"Perfektionismus hack: Schreibe absichtlich einen schlechten Roh-Absatz (4 Sätze). Ziel: ‘schlecht, aber da’." },
      { key:"w|Do 20:15", time:"Do 20:15", text:"Wenn du gerade prokrastinierst: Mach ‘Nur-eins’-Regel. Wähle eine Quelle und notiere 3 Stichworte: These, Beleg, Begriff." },
      { key:"w|Fr 10:40", time:"Fr 10:40", text:"Mini-Struktur: Erstelle eine Gliederung mit 3 Punkten (nur Titel). Ergebnis: 3 Zeilen, keine Details." },
      { key:"w|Sa 14:00", time:"Sa 14:00", text:"Zitat-Futter: Kopiere ein relevantes Zitat oder eine Passage (max 2 Sätze) in dein Doc und schreibe darunter: ‘Das nutze ich für …’." },
      { key:"w|So 19:05", time:"So 19:05", text:"Sanfter Wochenabschluss: Schreib 1 Frage, die du nächste Woche beantworten willst. Nur eine. Das ist dein Startpfeil." }
    ];

    const TESTIMONIALS = [
      {
        quote:"„Ich hab meine Bachelorarbeit wochenlang nur angeschaut. nugge hat mir jeden Tag diesen Mini-Start gegeben und plötzlich war ich drin.“",
        who:"Studentin, Geisteswissenschaften (Essay/Thesis)"
      },
      {
        quote:"„Bei Übungszetteln war’s immer: ‘gleich’. Dann war’s 23:50. nugge hat mich einfach auf ‘Aufgabe 1: Setup’ geschubst. Zwei Minuten, kein Drama.“",
        who:"Student, MINT (Mathe/Übungen)"
      },
      {
        quote:"„Ich blockiere mental, vor allem wenn’s ‘perfekt’ sein muss. Die Mini-Impulse haben mir erlaubt, erstmal roh zu arbeiten und dann dranzubleiben.“",
        who:"Studentin, Psychologie/Sozialwissenschaften (Lernen + Schreiben)"
      },
      {
        quote:"„Wenn ich programmieren sollte, hab ich stattdessen mein Handy gecheckt. nugge hat mir so kleine If-Then-Dinger gegeben, dass ich überhaupt anfange. Dann läuft’s.“",
        who:"Student, Informatik (Programmieren)"
      },
      {
        quote:"„Ich konnte nie durchhalten, weil ich nach dem Start nicht wusste, was ‘als Nächstes’ ist. nugge macht das klein. Ein Schritt. Ein Haken.“",
        who:"Studentin, BWL/WiWi (Projekt/Deadlines)"
      }
    ];

    // ---------------- Learn more text (kept as-is placeholder) ----------------
    const LEARN_MORE_TEXT =
`Nugge ist ein 7-Tage-Sprint: jeden Tag ein Mini-Start, der dich ins Tun bringt.
Du sagst kurz, wo du hängst. Nugge liefert dir den nächsten machbaren Schritt.`;

    // ---------------- Storage ----------------
    const S = {
      get signedIn(){ return localStorage.getItem("ng_signedIn") === "1"; },
      set signedIn(v){ localStorage.setItem("ng_signedIn", v ? "1" : "0"); },
      get pick(){ try { return JSON.parse(localStorage.getItem("ng_pick") || "null"); } catch { return null; } },
      set pick(obj){ localStorage.setItem("ng_pick", JSON.stringify(obj)); },
      get rotate(){ return parseInt(localStorage.getItem("ng_rotate") || "0", 10) || 0; },
      set rotate(n){ localStorage.setItem("ng_rotate", String(n)); },
      clear(){
        localStorage.removeItem("ng_signedIn");
        localStorage.removeItem("ng_pick");
        localStorage.removeItem("ng_rotate");
      }
    };

    // ---------------- Helpers ----------------
    const pad2 = (n) => String(n).padStart(2,"0");
    const nowStamp = (d=new Date()) =>
      `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())} ${pad2(d.getHours())}:${pad2(d.getMinutes())}:${pad2(d.getSeconds())}`;
    const dayKey = (d=new Date()) => `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;

    function hashStr(str){
      let h = 2166136261;
      for (let i=0;i<str.length;i++){
        h ^= str.charCodeAt(i);
        h = Math.imul(h, 16777619);
      }
      return (h >>> 0);
    }

    // Build a deterministic daily nugge from selected mode/focus
    function dailyNugge(pick, rotateOffset=0){
      const dk = dayKey();
      const pool = pick?.mode === "Informatik/Mathe"
        ? FEATURED_M.map(x => x.text)
        : FEATURED_W.map(x => x.text);

      const base = hashStr(`${dk}|${pick?.mode}|${pick?.focus}`);
      const idx = pool.length ? (base + rotateOffset) % pool.length : 0;
      return pool.length ? pool[idx] : "Bitte wähle kurz aus, wo du hängst.";
    }

    // ---------------- Views ----------------
    const viewHome   = document.getElementById("viewHome");
    const viewLearn  = document.getElementById("viewLearn");
    const viewPick   = document.getElementById("viewPick");
    const viewToday  = document.getElementById("viewToday");
    const viewDetail = document.getElementById("viewDetail");

    const statusPill = document.getElementById("statusPill");
    const logoutBtn  = document.getElementById("logoutBtn");

    let lastNonDetailView = viewHome;

    function showView(which){
      [viewHome, viewLearn, viewPick, viewToday, viewDetail].forEach(v => v.classList.remove("active"));
      which.classList.add("active");
      refreshHeader();
      window.scrollTo(0,0);
      if (which !== viewDetail) lastNonDetailView = which;
    }

    function refreshHeader(){
      statusPill.textContent = S.signedIn ? "Signed in" : "Sign in";
      logoutBtn.style.display = S.signedIn ? "inline-flex" : "none";
    }

    // ---------------- Render featured cards ----------------
    function renderFeatured(list, mountEl){
      mountEl.innerHTML = "";
      list.forEach(item => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <div class="topRow">
            <div class="user">${item.time}</div>
            <a class="subscribe" href="#" data-subscribe="${item.key}">Details</a>
          </div>
          <div class="msg">${item.text}</div>
          <div class="metaLine">Timestamp · ${item.time}</div>
          <div class="metaLine">Subscribers · — · Thumbs up · —</div>
        `;
        mountEl.appendChild(card);
      });
    }

    renderFeatured(FEATURED_M, document.getElementById("featuredStudentM"));
    renderFeatured(FEATURED_W, document.getElementById("featuredStudentW"));

    // Testimonials
    const tEl = document.getElementById("testimonials");
    tEl.innerHTML = "";
    TESTIMONIALS.forEach(t => {
      const c = document.createElement("div");
      c.className = "card";
      c.innerHTML = `
        <p class="quote">${t.quote}</p>
        <div class="who">${t.who}</div>
      `;
      tEl.appendChild(c);
    });

    // Learn more page
    document.getElementById("learnText").textContent = LEARN_MORE_TEXT;
    document.getElementById("learnMoreLink").addEventListener("click", (e) => {
      e.preventDefault();
      showView(viewLearn);
    });

    // ---------------- Pick page ----------------
    const modeChoices  = document.getElementById("modeChoices");
    const focusChoices = document.getElementById("focusChoices");
    const continueBtn  = document.getElementById("continueBtn");

    const MODES = ["Informatik/Mathe", "Geistes-/Sozialwissenschaften"];
    const FOCI  = ["Start-Reibung", "Overwhelm", "Perfektionismus", "Dranbleiben", "Nächster Schritt"];

    let tempPick = null;

    function renderChoiceGroup(container, items, onPick){
      container.innerHTML = "";
      items.forEach(label => {
        const el = document.createElement("div");
        el.className = "choice";
        el.textContent = label;
        el.tabIndex = 0;
        el.role = "button";
        el.addEventListener("click", () => onPick(label));
        el.addEventListener("keydown", (ev) => {
          if (ev.key === "Enter" || ev.key === " ") onPick(label);
        });
        container.appendChild(el);
      });
    }

    function clearSelectedIn(container){
      container.querySelectorAll(".choice.selected").forEach(x => x.classList.remove("selected"));
    }

    const state = { mode:null, focus:null };

    function maybeEnable(){
      continueBtn.disabled = !(state.mode && state.focus);
    }

    renderChoiceGroup(modeChoices, MODES, (label) => {
      state.mode = label;
      clearSelectedIn(modeChoices);
      [...modeChoices.children].forEach(n => { if (n.textContent === label) n.classList.add("selected"); });
      maybeEnable();
    });

    renderChoiceGroup(focusChoices, FOCI, (label) => {
      state.focus = label;
      clearSelectedIn(focusChoices);
      [...focusChoices.children].forEach(n => { if (n.textContent === label) n.classList.add("selected"); });
      maybeEnable();
    });

    // ---------------- Today view ----------------
    const todayDate = document.getElementById("todayDate");
    const todayUser = document.getElementById("todayUser");
    const todayMsg  = document.getElementById("todayMsg");
    const todayStamp= document.getElementById("todayStamp");
    const todaySubscribeLink = document.getElementById("todaySubscribeLink");

    function renderToday(){
      const pick = S.pick;
      if (!pick) return;

      todayDate.textContent  = `Datum · ${dayKey()}`;
      todayUser.textContent  = `${pick.mode} · ${pick.focus}`;
      todayMsg.textContent   = dailyNugge(pick, S.rotate);
      todayStamp.textContent = `Timestamp · ${nowStamp()}`;

      todaySubscribeLink.onclick = (e) => {
        e.preventDefault();
        openDetail(`Sprint · ${pick.mode}`, dailyNugge(pick, 0));
      };
    }

    // ---------------- Detail view ----------------
    const detailSub  = document.getElementById("detailSub");
    const detailUser = document.getElementById("detailUser");
    const detailMsg  = document.getElementById("detailMsg");
    const detailStamp= document.getElementById("detailStamp");
    const detailStats= document.getElementById("detailStats");
    const detailBackLink = document.getElementById("detailBackLink");
    const detailSubscribeBtn = document.getElementById("detailSubscribeBtn");
    const detailGetNuggedBtn = document.getElementById("detailGetNuggedBtn");

    function openDetail(label, text){
      detailSub.textContent  = `Beispiel · ${dayKey()}`;
      detailUser.textContent = label;
      detailMsg.textContent  = text;
      detailStamp.textContent= `Timestamp · ${nowStamp()}`;
      detailStats.textContent= `Subscribers · — · Thumbs up · —`;

      detailBackLink.onclick = (e) => {
        e.preventDefault();
        showView(lastNonDetailView || viewHome);
      };

      detailSubscribeBtn.onclick = () => alert("Subscribed (demo).");
      detailGetNuggedBtn.onclick = () => {
        S.signedIn = true;
        maybeEnable();
        showView(viewPick);
      };

      showView(viewDetail);
    }

    // Featured "Details" links open detail view
    document.addEventListener("click", (e) => {
      const a = e.target.closest("a[data-subscribe]");
      if (!a) return;
      e.preventDefault();
      const key = a.getAttribute("data-subscribe");
      const [who, when] = key.split("|");
      const src = (who === "m") ? FEATURED_M : FEATURED_W;
      const item = src.find(x => x.key === key);
      if (!item) return;
      openDetail("Beispiel", item.text);
    });

    // ---------------- Navigation ----------------
    const getNuggedBtn  = document.getElementById("getNuggedBtn");
    const backHomeLink  = document.getElementById("backHomeLink");
    const newNuggBtn    = document.getElementById("newNuggBtn");
    const changePickBtn = document.getElementById("changePickBtn");
    const brandHome     = document.getElementById("brandHome");

    brandHome.addEventListener("click", () => showView(viewHome));

    getNuggedBtn.addEventListener("click", () => {
      S.signedIn = true;
      // reset pick UI state
      state.mode = null; state.focus = null;
      continueBtn.disabled = true;
      [...modeChoices.children].forEach(n => n.classList.remove("selected"));
      [...focusChoices.children].forEach(n => n.classList.remove("selected"));
      showView(viewPick);
    });

    backHomeLink.addEventListener("click", (e) => {
      e.preventDefault();
      showView(viewHome);
    });

    continueBtn.addEventListener("click", () => {
      if (!(state.mode && state.focus)) return;
      S.pick = { mode: state.mode, focus: state.focus };
      S.rotate = 0;
      renderToday();
      showView(viewToday);
    });

    newNuggBtn.addEventListener("click", () => {
      S.rotate = (S.rotate + 1) % 9999;
      renderToday();
    });

    changePickBtn.addEventListener("click", () => {
      showView(viewPick);
    });

    logoutBtn.addEventListener("click", () => {
      S.clear();
      showView(viewHome);
    });

    // Init
    refreshHeader();
    if (S.signedIn && S.pick){
      renderToday();
      showView(viewToday);
    } else {
      showView(viewHome);
    }
  </script>
</body>
</html>